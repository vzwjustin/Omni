# Omni-Cortex Configuration
# Architecture: Gemini routes, Claude Code executes

# =============================================================================
# ARCHITECTURE OVERVIEW
# =============================================================================
# Gemini (cheap) → Task analysis, routing, execution plans
# Claude Code (local) → Receives rich context, does actual reasoning/coding
#
# This saves tokens: Gemini handles the "thinking about thinking" so Claude
# can focus on execution with rich pre-analyzed context.

# =============================================================================
# INFRASTRUCTURE & RESILIENCE (NEW)
# =============================================================================
# Rate Limiting (protects against API abuse and runaway costs)
# - Automatic per-tool categorization (llm/search/memory/utility)
# - Graceful degradation on rate limit exceeded
# - Per-category and global rate limits active

# Circuit Breakers (protects against cascade failures)
# - Automatic failure detection and fast-fail
# - Protected: All LLM calls, embeddings, ChromaDB operations
# - Fallback values prevent service degradation

# Prometheus Metrics (observability for production)
# - Framework execution metrics (duration, tokens, confidence)
# - Router decision metrics (latency, chain length)
# - Memory, RAG, Context Gateway, Circuit breaker metrics
# - Expose /metrics endpoint for scraping

# See ENHANCEMENTS.md for full infrastructure roadmap

# =============================================================================
# ROUTING MODEL (Required - Gemini for task analysis)
# =============================================================================
GOOGLE_API_KEY=your_google_api_key_here

# Model for routing/analysis (Gemini 3 Flash is fast & cheap)
ROUTING_MODEL=gemini-3-flash-preview

# =============================================================================
# EMBEDDINGS (for ChromaDB / RAG)
# =============================================================================
# Gemini embeddings: FREE (1500 req/day), high quality
EMBEDDING_PROVIDER=gemini
EMBEDDING_MODEL=text-embedding-004

# Alternative: OpenAI or OpenRouter (paid)
# EMBEDDING_PROVIDER=openrouter
# EMBEDDING_MODEL=text-embedding-3-small
# OPENAI_API_KEY=your_openai_api_key_here  # If using OpenAI embeddings


# =============================================================================
# CHROMADB STORAGE
# =============================================================================
CHROMA_PERSIST_DIR=/app/data/chroma

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_AUTO_INGEST=true
ENABLE_DSPY_OPTIMIZATION=true
ENABLE_PRM_SCORING=true

# =============================================================================
# CONTEXT GATEWAY ENHANCEMENTS
# =============================================================================

# Cache Settings
ENABLE_CONTEXT_CACHE=true
CACHE_QUERY_ANALYSIS_TTL=3600        # 1 hour
CACHE_FILE_DISCOVERY_TTL=1800        # 30 minutes
CACHE_DOCUMENTATION_TTL=86400        # 24 hours
CACHE_MAX_ENTRIES=1000
CACHE_MAX_SIZE_MB=100
ENABLE_STALE_CACHE_FALLBACK=true

# Circuit Breaker Settings
ENABLE_CIRCUIT_BREAKER=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
CIRCUIT_BREAKER_HALF_OPEN_TIMEOUT=30

# Streaming Settings
ENABLE_STREAMING_CONTEXT=true
STREAMING_PROGRESS_INTERVAL=0.5
ENABLE_COMPLETION_ESTIMATION=true

# Multi-Repository Settings
ENABLE_MULTI_REPO_DISCOVERY=true
MULTI_REPO_MAX_REPOSITORIES=10
MULTI_REPO_MAX_CONCURRENT=5
MULTI_REPO_ANALYSIS_TIMEOUT=30.0
ENABLE_CROSS_REPO_DEPENDENCIES=true

# Token Budget Management
ENABLE_DYNAMIC_TOKEN_BUDGET=true
TOKEN_BUDGET_LOW_COMPLEXITY=30000
TOKEN_BUDGET_MEDIUM_COMPLEXITY=50000
TOKEN_BUDGET_HIGH_COMPLEXITY=80000
TOKEN_BUDGET_VERY_HIGH_COMPLEXITY=120000
ENABLE_CONTENT_OPTIMIZATION=true

# Enhanced Documentation Settings
ENABLE_SOURCE_ATTRIBUTION=true
ENABLE_DOCUMENTATION_PRIORITIZATION=true
DOCUMENTATION_AUTHORITY_THRESHOLD=0.7

# Metrics and Monitoring
ENABLE_ENHANCED_METRICS=true
ENABLE_QUALITY_SCORING=true
ENABLE_PERFORMANCE_TRACKING=true
METRICS_RETENTION_DAYS=30
ENABLE_PROMETHEUS_METRICS=true

# Thinking Mode Optimization
ENABLE_ADAPTIVE_THINKING_MODE=true
THINKING_MODE_COMPLEXITY_THRESHOLD=medium
THINKING_MODE_TOKEN_THRESHOLD=20000

# =============================================================================
# MCP TOOL EXPOSURE
# =============================================================================
# LEAN_MODE=true (default) → Only expose essential tools (10 tools)
#   prepare_context, prepare_context_streaming, context_cache_status, reason, 
#   execute_code, health + 4 context optimization tools
#   HyperRouter handles framework selection internally
#   Saves ~55k tokens in MCP tool definitions
# LEAN_MODE=false → Expose all 83 tools (62 think_* + 21 utilities)
LEAN_MODE=true

# =============================================================================
# EXECUTION MODE
# =============================================================================
# USE_LANGCHAIN_LLM=false → Template mode (Claude Code executes)
# USE_LANGCHAIN_LLM=true → Server calls LLM (burns API tokens)
USE_LANGCHAIN_LLM=false

# LLM_PROVIDER only used if USE_LANGCHAIN_LLM=true
# Leave as pass-through for Claude Code execution
LLM_PROVIDER=pass-through

# =============================================================================
# LIMITS & TUNING
# =============================================================================
MAX_REASONING_DEPTH=10
MCTS_MAX_ROLLOUTS=50
DEBATE_MAX_ROUNDS=5

# =============================================================================
# LOGGING
# =============================================================================
LOG_LEVEL=INFO
