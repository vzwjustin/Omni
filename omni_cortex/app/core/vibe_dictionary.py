"""
Vibe Dictionary: Natural language pattern matching for framework selection.

This module contains the VIBE_DICTIONARY - a mapping of framework names to lists
of casual "vibe" phrases that developers use when describing their problems.
The router uses this for fast first-pass framework selection before falling back
to more expensive LLM-based routing.

Philosophy: Developers should be able to describe their problem naturally
("wtf is wrong with this code", "make it faster", "clean up this mess")
and get routed to the right reasoning framework without knowing framework names.

Usage:
    from .vibe_dictionary import VIBE_DICTIONARY, match_vibes

    # Quick check for a matching framework
    framework = match_vibes("why is this broken")
    if framework:
        return framework  # "active_inference"
"""


# =========================================================================
# VIBE DICTIONARY: Casual activation phrases for vibe coders
# =========================================================================
# Just say what you want naturally - we'll figure out the right framework

VIBE_DICTIONARY = {
    # Debugging vibes - hypothesis testing loop
    "active_inference": [
        "why is this broken",
        "wtf is wrong",
        "this doesn't work",
        "find the bug",
        "debug this",
        "what's causing this",
        "figure out why",
        "track down",
        "root cause",
        "investigate",
        "something's off",
        "it's acting weird",
        "unexpected behavior",
        "why does this",
        "what the hell",
        "broken af",
        "not working",
        "keeps crashing",
        "throwing errors",
        "fails randomly",
        "intermittent bug",
        "heisenbug",
        "works on my machine",
        "production bug",
        "regression",
        "stopped working",
        "used to work",
        "suddenly broke",
        "after update",
        "null pointer",
        "undefined",
        "NaN",
        "empty result",
        "segfault",
        "memory corruption",
        "race condition",
        "deadlock",
        "timeout",
        "connection refused",
        "500 error",
        "stack overflow",
        "infinite loop",
        "recursion error",
    ],
    # Refactoring vibes - structured cleanup
    "graph_of_thoughts": [
        "clean this up",
        "this code is ugly",
        "make it not suck",
        "untangle this mess",
        "spaghetti code",
        "needs refactoring",
        "reorganize",
        "restructure",
        "make it cleaner",
        "simplify this",
        "code smell",
        "tech debt",
        "legacy code",
        "maintainable",
        "readable",
        "DRY this up",
        "extract method",
        "decompose",
        "too complex",
        "cyclomatic complexity",
        "nested hell",
        "callback hell",
        "pyramid of doom",
        "deeply nested",
        "hard to follow",
        "confusing code",
        "wtf per minute",
        "kill it with fire",
        "rewrite this junk",
        "modernize",
        "from class to functional",
        "hooks refactor",
        "migration",
    ],
    # Architecture vibes - system design
    "reason_flux": [
        "design a system",
        "architect this",
        "how should I structure",
        "plan this out",
        "big picture",
        "system design",
        "make it scalable",
        "build from scratch",
        "greenfield",
        "new project",
        "overall approach",
        "microservices",
        "monolith",
        "architecture",
        "high level design",
        "design patterns",
        "SOLID",
        "clean architecture",
        "hexagonal",
        "domain driven",
        "DDD",
        "event driven",
        "CQRS",
        "event sourcing",
        "API design",
        "schema design",
        "data model",
        "ERD",
        "infrastructure",
        "deployment",
        "CI/CD pipeline",
        "aws architecture",
        "cloud native",
        "serverless",
        "kubernetes",
        "folder structure",
        "project layout",
        "directory structure",
    ],
    # Algorithm/optimization vibes
    "tree_of_thoughts": [
        "make it faster",
        "optimize this",
        "too slow",
        "performance sucks",
        "better algorithm",
        "more efficient",
        "reduce complexity",
        "speed this up",
        "it's laggy",
        "bottleneck",
        "O(n^2)",
        "time complexity",
        "space complexity",
        "memory leak",
        "CPU intensive",
        "optimize query",
        "slow query",
        "N+1",
        "caching",
        "memoization",
        "lazy loading",
        "pagination",
        "batch processing",
        "async",
        "parallel",
        "concurrent",
        "profiling",
        "benchmark",
        "perf issues",
        "latency",
        "indexing",
        "database tuning",
        "load time",
        "render performance",
    ],
    # Fast generation vibes - scaffolding
    "skeleton_of_thought": [
        "just generate",
        "scaffold",
        "boilerplate",
        "quick template",
        "stub this out",
        "starter code",
        "basic structure",
        "skeleton",
        "rough draft",
        "get me started",
        "wireframe",
        "prototype",
        "MVP",
        "proof of concept",
        "POC",
        "quick prototype",
        "bare bones",
        "minimal version",
        "starting point",
        "init project",
        "create new",
        "bootstrap",
        "setup",
        "hello world",
        "base plate",
        "cookie cutter",
    ],
    # API/library vibes - external integration
    "critic": [
        "using this library",
        "api integration",
        "third party",
        "how do I use",
        "sdk",
        "package",
        "library docs",
        "correct usage",
        "best practice for",
        "npm package",
        "pip install",
        "import",
        "dependency",
        "module",
        "REST API",
        "GraphQL",
        "webhook",
        "OAuth",
        "JWT",
        "external service",
        "integration",
        "connect to",
        "API call",
        "fetch",
        "axios",
        "requests",
        "read the docs",
        "documentation says",
        "api reference",
    ],
    # Security/verification vibes
    "chain_of_verification": [
        "is this secure",
        "security check",
        "audit this",
        "vulnerabilities",
        "could this be hacked",
        "pen test",
        "code review",
        "sanity check",
        "validate this",
        "double check",
        "verify",
        "confirm",
        "make sure",
        "correct?",
        "looks right?",
        "review my code",
        "spot check",
        "find issues",
        "catch bugs",
        "QA",
        "quality check",
        "before merging",
        "PR review",
        "pull request",
        "lgtm",
        "nitpick",
        "blocker",
        "critical issue",
    ],
    # Math/compute vibes - calculations
    "program_of_thoughts": [
        "calculate",
        "compute",
        "do the math",
        "run the numbers",
        "data processing",
        "transform data",
        "crunch",
        "analyze data",
        "formula",
        "equation",
        "statistics",
        "aggregate",
        "sum",
        "average",
        "median",
        "percentile",
        "distribution",
        "pandas",
        "numpy",
        "dataframe",
        "CSV",
        "JSON transform",
        "ETL",
        "data pipeline",
        "data munging",
        "wrangling",
        "fibonacci",
        "factorial",
        "prime numbers",
        "matrix multiplication",
    ],
    # Creative/novel vibes - unique problems
    "self_discover": [
        "I have no idea",
        "weird problem",
        "never seen this",
        "creative solution",
        "think outside box",
        "novel approach",
        "unconventional",
        "unique situation",
        "edge case",
        "bizarre",
        "strange bug",
        "unusual",
        "one-off",
        "special case",
        "corner case",
        "rare scenario",
        "no documentation",
        "undocumented",
        "black box",
        "reverse engineering",
        "figure it out",
        "puzzling",
        "magic",
        "voodoo",
        "haunted code",
        "ghost in the machine",
    ],
    # Deep search vibes - complex exploration
    "mcts_rstar": [
        "really hard bug",
        "been stuck for hours",
        "complex issue",
        "multi-step problem",
        "deep issue",
        "intricate bug",
        "need to explore options",
        "thorough search",
        "exhaustive",
        "all possibilities",
        "brute force",
        "search space",
        "combinatorial",
        "permutations",
        "game tree",
        "decision tree",
        "branch and bound",
        "stuck for days",
        "impossible bug",
        "nightmare",
        "burning out",
        "hitting a wall",
        "desperate",
    ],
    # Decision vibes - weighing options
    "multi_agent_debate": [
        "should I use A or B",
        "trade-offs",
        "pros and cons",
        "which approach",
        "compare options",
        "decision",
        "evaluate",
        "weigh options",
        "what would you recommend",
        "best choice",
        "React or Vue",
        "SQL or NoSQL",
        "REST or GraphQL",
        "which framework",
        "which library",
        "which database",
        "monorepo or multirepo",
        "serverless or containers",
        "build vs buy",
        "roll own or use existing",
        "opinions",
        "debate",
        "argument",
        "settle this",
        "tie breaker",
    ],
    # Big change vibes - major overhaul
    "everything_of_thought": [
        "major rewrite",
        "big migration",
        "overhaul",
        "massive change",
        "complete redesign",
        "from scratch",
        "total refactor",
        "modernize",
        "upgrade everything",
        "v2",
        "next version",
        "breaking changes",
        "deprecate",
        "sunset",
        "EOL",
        "migration path",
        "upgrade path",
        "replatform",
        "technical transformation",
        "rebuild",
        "redo everything",
        "strangler fig",
        "rip and replace",
        "lift and shift",
    ],
    # Pattern vibes - known solutions
    "buffer_of_thoughts": [
        "I've done this before",
        "standard pattern",
        "common task",
        "typical",
        "usual approach",
        "boilerplate",
        "routine",
        "CRUD",
        "login flow",
        "auth",
        "pagination",
        "search filter",
        "form validation",
        "file upload",
        "email sending",
        "notifications",
        "logging",
        "error handling",
        "retry logic",
        "rate limiting",
        "design pattern",
        "singleton",
        "factory",
        "observer",
    ],
    # Long context vibes - multi-file awareness
    "coala": [
        "lots of files",
        "whole codebase",
        "across multiple files",
        "context from",
        "remember earlier",
        "stateful",
        "keep track",
        "monorepo",
        "large codebase",
        "enterprise",
        "legacy system",
        "multiple services",
        "cross-cutting",
        "shared code",
        "dependencies between",
        "imports from",
        "circular dependency",
        "file structure",
        "project organization",
        "modules",
        "global search",
        "find usages",
        "where is this defined",
    ],
    # Research vibes - understanding code
    "chain_of_note": [
        "understand this code",
        "explain",
        "what does this do",
        "learn the codebase",
        "document",
        "figure out how",
        "reverse engineer",
        "how does it work",
        "explain like",
        "ELI5",
        "walk through",
        "code walkthrough",
        "documentation",
        "comments",
        "README",
        "wiki",
        "onboarding",
        "new to codebase",
        "ramping up",
        "summary",
        "tldr",
        "synopsis",
        "notes",
    ],
    # Abstraction vibes - first principles
    "step_back": [
        "big O",
        "complexity analysis",
        "fundamentals",
        "first principles",
        "underlying concept",
        "theory behind",
        "abstract thinking",
        "CS fundamentals",
        "data structures",
        "algorithms",
        "design principles",
        "patterns",
        "anti-patterns",
        "why does this work",
        "how does this work",
        "under the hood",
        "internals",
        "implementation details",
        "deep dive",
        "zoom out",
        "high level view",
        "conceptual",
    ],
    # Analogy vibes - similar solutions
    "analogical": [
        "like when",
        "similar to",
        "pattern from",
        "reminds me of",
        "same as",
        "analogous",
        "comparable to",
        "like in",
        "inspired by",
        "borrowed from",
        "adapted from",
        "seen this before",
        "familiar pattern",
        "like that other",
        "copy from",
        "based on",
        "reference implementation",
        "metaphor",
        "example",
        "instance",
    ],
    # Adaptive vibes - flexible approach
    "adaptive_injection": [
        "just figure it out",
        "do your thing",
        "whatever works",
        "adapt",
        "flex",
        "go with the flow",
        "surprise me",
        "your call",
        "you decide",
        "best judgment",
        "improvise",
        "wing it",
        "play it by ear",
        "dynamic approach",
        "flexible solution",
        "smart select",
        "auto mode",
        "magic mode",
    ],
    # Requirements vibes - spec driven
    "re2": [
        "requirements",
        "spec",
        "constraints",
        "must have",
        "needs to",
        "requirements doc",
        "acceptance criteria",
        "user story",
        "ticket",
        "JIRA",
        "specification",
        "functional requirements",
        "non-functional",
        "NFR",
        "SLA",
        "compliance",
        "regulatory",
        "legal requirements",
        "business rules",
        "validation rules",
        "invariants",
        "as a user",
        "given when then",
        "checklist",
    ],
    # Quick vibes - simple tasks
    "system1": [
        "quick question",
        "simple fix",
        "easy",
        "obvious",
        "just do it",
        "no brainer",
        "trivial",
        "one liner",
        "fast answer",
        "real quick",
        "simple",
        "straightforward",
        "basic",
        "elementary",
        "beginner",
        "101",
        "quick fix",
        "hotfix",
        "patch",
        "typo",
        "rename",
        "move",
        "delete",
        "add comment",
        "format code",
        "indentation",
        "whitespace",
    ],
    # Code decomposition vibes
    "chain_of_code": [
        "code blocks",
        "pseudocode",
        "execution trace",
        "logic puzzle",
        "recursive logic",
        "algorithmic complexity",
        "structured thinking",
        "break into code",
        "code decomposition",
        "step through",
        "trace execution",
        "follow the code",
        "code flow",
        "control flow",
        "data flow",
        "call stack",
        "breakpoints",
        "debugger",
        "line by line",
        "inspect",
        "variable state",
        "heap",
        "stack",
    ],
    # Pre-validation vibes
    "self_debugging": [
        "test before showing",
        "mental execution",
        "trace through",
        "prevent bugs",
        "check my work",
        "simulate execution",
        "off by one",
        "edge case check",
        "dry run",
        "desk check",
        "code review myself",
        "self review",
        "before committing",
        "sanity test",
        "smoke test",
        "manual testing",
        "walkthrough",
        "trace",
        "pre-flight",
        "double check logic",
    ],
    # TDD vibes
    "tdd_prompting": [
        "test first",
        "write tests",
        "TDD",
        "test driven",
        "unit tests",
        "edge cases",
        "test coverage",
        "red green refactor",
        "tests then code",
        "jest",
        "pytest",
        "mocha",
        "junit",
        "testing framework",
        "mock",
        "stub",
        "spy",
        "fixture",
        "assertion",
        "expect",
        "should",
        "test case",
        "integration test",
        "e2e test",
        "selenium",
        "cypress",
        "playwright",
    ],
    # Reverse debugging vibes
    "reverse_cot": [
        "wrong output",
        "expected vs actual",
        "why different output",
        "output delta",
        "silent bug",
        "calculation error",
        "backwards debugging",
        "work backward",
        "reverse engineer bug",
        "expected X got Y",
        "off by",
        "incorrect result",
        "wrong answer",
        "bad output",
        "unexpected result",
        "diff",
        "mismatch",
        "discrepancy",
        "log analysis",
        "traceback analysis",
    ],
    # Socratic vibes
    "rubber_duck": [
        "explain to me",
        "walk me through",
        "ask me questions",
        "guide me",
        "help me think",
        "rubber duck",
        "Socratic method",
        "lead me to answer",
        "questioning approach",
        "talk it through",
        "think aloud",
        "verbalize",
        "explain my thinking",
        "work through it",
        "reasoning",
        "pair program",
        "code buddy",
        "sounding board",
    ],
    # Tool use vibes
    "react": [
        "use tools",
        "multi-step",
        "action reasoning",
        "tool use",
        "step and observe",
        "interact with",
        "reasoning acting",
        "ReAct pattern",
        "observe results",
        "API calls",
        "external tools",
        "shell commands",
        "file operations",
        "database queries",
        "web requests",
        "scrape",
        "curl",
        "wget",
        "grep",
        "find",
    ],
    # Learning vibes
    "reflexion": [
        "learn from mistakes",
        "retry",
        "failed attempt",
        "try again",
        "reflect on",
        "what went wrong",
        "iterative learning",
        "self-evaluation",
        "memory-based",
        "previous attempt",
        "last time",
        "improve on",
        "lessons learned",
        "retrospective",
        "post-mortem",
        "root cause analysis",
        "RCA",
        "incident report",
    ],
    # Quality vibes
    "self_refine": [
        "improve quality",
        "polish",
        "refine",
        "make it better",
        "iterative improvement",
        "critique and improve",
        "self-critique",
        "refinement loop",
        "quality pass",
        "clean up",
        "tighten up",
        "optimize",
        "beautify",
        "format",
        "lint",
        "prettier",
        "black",
        "isort",
        "ruff",
        "flake8",
        "pylint",
    ],
    # Bottom-up vibes
    "least_to_most": [
        "atomic functions",
        "dependency graph",
        "bottom up",
        "layered",
        "base functions first",
        "decompose completely",
        "building blocks",
        "hierarchical build",
        "least dependent first",
        "utils first",
        "helpers",
        "primitives",
        "foundation",
        "core functions",
        "base layer",
        "component library",
        "atoms",
        "molecules",
        "organisms",
    ],
    # Comparison vibes
    "comparative_arch": [
        "compare approaches",
        "readability vs performance",
        "trade-offs",
        "multiple solutions",
        "which is faster",
        "optimize for",
        "different versions",
        "performance vs memory",
        "three approaches",
        "show me options",
        "alternatives",
        "variations",
        "different ways",
        "multiple implementations",
        "compare",
        "benchmark results",
        "A/B test",
        "matrix",
    ],
    # Planning vibes
    "plan_and_solve": [
        "plan first",
        "think before coding",
        "explicit plan",
        "strategy",
        "outline approach",
        "plan then execute",
        "methodical",
        "step by step plan",
        "planning phase",
        "roadmap",
        "game plan",
        "action plan",
        "checklist",
        "todo list",
        "phases",
        "milestones",
        "technical spec",
        "design document",
        "RFC",
    ],
    # Security audit vibes
    "red_team": [
        "security audit",
        "vulnerabilities",
        "pen test",
        "security review",
        "find exploits",
        "attack vectors",
        "OWASP",
        "SQLi",
        "XSS",
        "security threats",
        "hack this",
        "injection",
        "CSRF",
        "SSRF",
        "RCE",
        "privilege escalation",
        "authentication bypass",
        "broken access control",
        "sensitive data exposure",
        "data breach",
        "leak",
        "encryption",
        "hashing",
        "salt",
    ],
    # State management vibes
    "state_machine": [
        "state machine",
        "FSM",
        "states and transitions",
        "workflow",
        "state diagram",
        "UI states",
        "game states",
        "state management",
        "transitions",
        "Redux",
        "Zustand",
        "MobX",
        "Vuex",
        "finite automata",
        "statechart",
        "xstate",
        "loading states",
        "error states",
        "success states",
        "hydration",
        "client state",
        "server state",
    ],
    # Basic reasoning vibes
    "chain_of_thought": [
        "think step by step",
        "reason through",
        "work through",
        "logical steps",
        "step by step",
        "reasoning chain",
        "think carefully",
        "show your work",
        "explicit reasoning",
        "break it down",
        "one step at a time",
        "systematically",
        "logically",
        "methodically",
        "carefully",
        "first",
        "then",
        "finally",
        "consequently",
    ],
    # Competitive programming vibes
    "alphacodium": [
        "competitive programming",
        "code contest",
        "algorithm challenge",
        "iterative code",
        "test-based",
        "multi-stage",
        "code generation",
        "contest problem",
        "leetcode",
        "hackerrank",
        "codeforces",
        "topcoder",
        "advent of code",
        "interview question",
        "coding interview",
        "whiteboard",
        "DSA",
        "data structures and algorithms",
        "dynamic programming",
        "graph theory",
        "greedy algorithm",
    ],
    # Modular vibes
    "codechain": [
        "modular code",
        "sub-modules",
        "self-revision",
        "incremental",
        "chain revisions",
        "module by module",
        "component based",
        "build incrementally",
        "refine modules",
        "microservices",
        "packages",
        "libraries",
        "separation of concerns",
        "single responsibility",
        "interface segregation",
        "dependency injection",
    ],
    # Evolutionary vibes
    "evol_instruct": [
        "evolve solution",
        "add constraints",
        "increase complexity",
        "challenging problem",
        "constraint-based",
        "evolutionary",
        "harder version",
        "more constraints",
        "complex requirements",
        "additional requirements",
        "scope creep",
        "feature creep",
        "extend",
        "enhance",
        "augment",
        "expand",
        "version 2",
        "next iteration",
        "advanced features",
    ],
    # Iteration vibes
    "llmloop": [
        "feedback loop",
        "iterate until",
        "compile and fix",
        "test loop",
        "automated testing",
        "quality assurance",
        "production ready",
        "lint and fix",
        "keep iterating",
        "CI/CD",
        "build pipeline",
        "automated checks",
        "pre-commit hooks",
        "continuous improvement",
        "nightly build",
        "regression testing",
    ],
    # Project integration vibes
    "procoder": [
        "compiler feedback",
        "project level",
        "codebase integration",
        "API usage",
        "large project",
        "integrate with",
        "project context",
        "compiler errors",
        "fix imports",
        "type errors",
        "typescript",
        "mypy",
        "pylint",
        "ESLint errors",
        "build errors",
        "dependency issues",
        "linker error",
        "module not found",
        "circular import",
    ],
    # High-stakes vibes
    "recode": [
        "multiple candidates",
        "cross validate",
        "CFG debugging",
        "control flow",
        "reliable code",
        "high stakes",
        "validate candidates",
        "majority voting",
        "robust solution",
        "mission critical",
        "production critical",
        "can't fail",
        "financial",
        "healthcare",
        "safety critical",
        "consensus",
        "redundancy",
        "fault tolerant",
        "zero downtime",
        "utility class",
        "nuclear",
    ],
    # =========================================================================
    # VERIFICATION FRAMEWORKS
    # =========================================================================
    # Multi-sample voting vibes
    "self_consistency": [
        "multiple answers",
        "vote",
        "consensus",
        "majority",
        "check multiple times",
        "sample answers",
        "consistency check",
        "are you sure",
        "double check",
        "verify answer",
        "ambiguous",
        "uncertain",
        "could be either",
        "tricky logic",
        "multiple plausible",
        "which is right",
    ],
    # Sub-question vibes
    "self_ask": [
        "break down",
        "sub-questions",
        "what do I need to know",
        "before I can answer",
        "first need to understand",
        "unclear requirements",
        "missing info",
        "need clarification",
        "what questions should I ask",
        "decompose the problem",
        "prerequisite knowledge",
        "dependencies between parts",
    ],
    # Rephrase vibes
    "rar": [
        "rephrase",
        "clarify the question",
        "what exactly",
        "be more specific",
        "unclear request",
        "vague",
        "what do you mean",
        "interpret as",
        "restate",
        "poorly written",
        "confusing request",
        "ambiguous ask",
    ],
    # Verify-edit vibes
    "verify_and_edit": [
        "verify claims",
        "fact check",
        "edit only wrong parts",
        "surgical fix",
        "minimal changes",
        "preserve good parts",
        "check each claim",
        "verify then edit",
        "patch specific",
        "don't rewrite everything",
        "targeted fix",
        "precision edit",
    ],
    # Research-revise vibes
    "rarr": [
        "evidence based",
        "prove it",
        "cite sources",
        "grounded",
        "research first",
        "find evidence",
        "back it up",
        "documentation says",
        "according to docs",
        "verified by",
        "need proof",
        "show me where",
        "source please",
    ],
    # Hallucination check vibes
    "selfcheckgpt": [
        "am I hallucinating",
        "is this real",
        "sanity check",
        "might be wrong",
        "not sure if true",
        "verify accuracy",
        "could be making this up",
        "confidence check",
        "before I trust this",
        "credibility check",
        "final check",
        "pre-flight",
        "gate check",
    ],
    # Metamorphic test vibes
    "metaqa": [
        "test with variations",
        "edge cases",
        "what if slightly different",
        "invariants",
        "should work for all",
        "consistency across",
        "metamorphic",
        "transform and check",
        "robustness test",
        "works for this but not that",
        "brittle",
        "fragile logic",
    ],
    # RAG assessment vibes
    "ragas": [
        "evaluate retrieval",
        "RAG quality",
        "were sources relevant",
        "faithfulness",
        "did it use sources",
        "grounded in docs",
        "retrieval quality",
        "chunk relevance",
        "answer quality",
        "RAG pipeline",
        "evaluate RAG",
        "retrieval assessment",
    ],
    # =========================================================================
    # AGENT FRAMEWORKS
    # =========================================================================
    # Plan-execute vibes
    "rewoo": [
        "plan first then execute",
        "tool schedule",
        "batch tools",
        "reasoning without observation",
        "plan once",
        "efficient tools",
        "tool-free plan",
        "expected observations",
        "tool budget",
        "minimize tool calls",
        "strategic tools",
        "planned execution",
    ],
    # Tree search agent vibes
    "lats": [
        "action tree",
        "multiple paths",
        "backtrack if fails",
        "tree search",
        "action sequences",
        "branch and bound",
        "rollback possible",
        "try different paths",
        "agent search",
        "strategic agent",
        "action planning",
        "branch exploration",
    ],
    # Modular agent vibes
    "mrkl": [
        "specialized modules",
        "security module",
        "perf module",
        "modular reasoning",
        "route to expert",
        "different perspectives",
        "orchestrate modules",
        "domain experts",
        "specialized handling",
        "big system",
        "mixed domains",
        "module routing",
    ],
    # SWE execution vibes
    "swe_agent": [
        "make tests pass",
        "CI green",
        "fix build",
        "inspect repo",
        "multi-file fix",
        "iterate until passing",
        "run tests",
        "check lint",
        "verify build",
        "software engineering",
        "repo workflow",
        "CI/CD fix",
    ],
    # Tool policy vibes
    "toolformer": [
        "when to use tools",
        "tool decision",
        "justify tool use",
        "tool policy",
        "smart tools",
        "efficient tool use",
        "tool selection",
        "optimize tool calls",
        "tool strategy",
        "when is tool needed",
        "tool cost benefit",
    ],
    # =========================================================================
    # RAG FRAMEWORKS
    # =========================================================================
    # Self-triggered retrieval vibes
    "self_rag": [
        "retrieve when needed",
        "selective retrieval",
        "confidence based",
        "not sure need to check",
        "maybe retrieve",
        "targeted search",
        "retrieve for uncertain",
        "gap-driven retrieval",
        "don't retrieve everything",
        "smart retrieval",
    ],
    # Hypothetical doc vibes
    "hyde": [
        "hypothetical document",
        "ideal answer",
        "what would doc say",
        "fuzzy query",
        "vague search",
        "broad search",
        "unclear what to search",
        "improve retrieval",
        "query expansion",
        "semantic search improvement",
    ],
    # Multi-query fusion vibes
    "rag_fusion": [
        "multiple queries",
        "query variations",
        "fuse results",
        "rank fusion",
        "better recall",
        "diverse queries",
        "query diversity",
        "combine searches",
        "aggregate results",
        "comprehensive search",
        "thorough retrieval",
    ],
    # Hierarchical retrieval vibes
    "raptor": [
        "hierarchical search",
        "summary first",
        "drill down",
        "abstraction levels",
        "overview then details",
        "huge document",
        "long document",
        "large codebase",
        "lost in chunks",
        "tree retrieval",
        "multi-level",
    ],
    # Entity-relation vibes
    "graphrag": [
        "entity relations",
        "dependency graph",
        "how things connect",
        "module relationships",
        "call graph",
        "data flow",
        "impact analysis",
        "blast radius",
        "what depends on",
        "architecture map",
        "relation extraction",
        "knowledge graph",
    ],
    # =========================================================================
    # CODE FRAMEWORKS (Additional)
    # =========================================================================
    # Program-aided vibes
    "pal": [
        "code to reason",
        "compute answer",
        "executable logic",
        "algorithm as code",
        "run to verify",
        "code substrate",
        "program for answer",
        "computation",
        "calculate with code",
        "numeric reasoning",
        "code-based math",
    ],
    # Scratchpad vibes
    "scratchpads": [
        "working notes",
        "scratch space",
        "intermediate work",
        "track state",
        "multi-step notes",
        "organized thinking",
        "structured notes",
        "work area",
        "keep track",
        "progressive notes",
        "step tracker",
    ],
    # Compositional code vibes
    "parsel": [
        "compositional",
        "dependency graph",
        "function specs",
        "decompose into functions",
        "build from specs",
        "spec to code",
        "natural language specs",
        "function dependencies",
        "bottom up build",
        "break into functions",
        "modular from spec",
        "compose functions",
        "spec driven",
        "from requirements",
        "hierarchical functions",
        "dependency order",
        "build order",
        "layered implementation",
    ],
    # Documentation-driven vibes
    "docprompting": [
        "from documentation",
        "follow the docs",
        "docs say",
        "according to documentation",
        "api docs",
        "official docs",
        "documentation example",
        "doc-driven",
        "read the docs",
        "rtfm",
        "manual says",
        "reference docs",
        "usage example",
        "as documented",
        "per documentation",
        "library docs",
        "sdk documentation",
        "api reference",
        "doc examples",
    ],
}


def match_vibes(query: str) -> str | None:
    """
    Check query against vibe dictionary with weighted scoring.

    Scoring rules:
    - Longer phrase matches score higher (phrase length * 2)
    - Multiple matches accumulate
    - Multi-word phrases get bonus weight

    Args:
        query: The user's natural language query

    Returns:
        Framework name if strong match found, None otherwise.
    """
    query_lower = query.lower()

    # Score each framework by vibe matches with weighted scoring
    scores = {}
    for framework, vibes in VIBE_DICTIONARY.items():
        total_score = 0.0

        for vibe in vibes:
            if vibe in query_lower:
                # Weight by phrase length - longer phrases are more specific
                word_count = len(vibe.split())
                # Multi-word phrases get bonus (2x for 2 words, 3x for 3+ words)
                weight = word_count if word_count >= 2 else 0.5
                total_score += weight

        if total_score > 0:
            scores[framework] = total_score

    # Return if we have a clear winner
    if scores:
        best = max(scores, key=scores.get)
        second_best_score = 0
        if len(scores) > 1:
            second_best_score = sorted(scores.values(), reverse=True)[1]

        # Require:
        # - Score >= 2 (at least one 2-word match or two 1-word matches), OR
        # - Clear leader (50% more than second place), OR
        # - Single match with score >= 1
        score_margin = scores[best] / (second_best_score + 0.001)
        if scores[best] >= 2 or score_margin >= 1.5 or (len(scores) == 1 and scores[best] >= 0.5):
            return best

    return None
